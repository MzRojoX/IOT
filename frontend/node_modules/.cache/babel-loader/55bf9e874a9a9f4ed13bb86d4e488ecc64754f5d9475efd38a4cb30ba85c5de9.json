{"ast":null,"code":"var _jsxFileName = \"/home/mzrojox/IOT/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport axios from 'axios';\nimport Sidebar from './components/Sidebar';\nimport TimelineChart from './components/TimelineChart';\nimport HistoryChart from './components/HistoryChart';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = 'http://localhost:8000/api';\nfunction App() {\n  _s();\n  var _zonas$find;\n  const [selectedZona, setSelectedZona] = useState(null);\n  const [zonas, setZonas] = useState([]);\n  const [eventosCarros, setEventosCarros] = useState([]);\n  const [eventosAnimales, setEventosAnimales] = useState([]);\n  const [alertas, setAlertas] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [notificaciones, setNotificaciones] = useState({});\n  const lastHashRef = useRef({});\n  const pollIntervalRef = useRef(null);\n\n  // Hash para detectar cambios sin recargar todo\n  const getHash = data => {\n    try {\n      return JSON.stringify(data).substring(0, 100);\n    } catch {\n      return '';\n    }\n  };\n\n  // Cargar zonas una sola vez\n  useEffect(() => {\n    const fetchZonas = async () => {\n      try {\n        const response = await axios.get(`${API_BASE_URL}/zonas`);\n        setZonas(response.data);\n        if (response.data.length > 0) {\n          setSelectedZona(response.data[0].id);\n        }\n      } catch (error) {\n        console.error('Error cargando zonas:', error);\n      }\n    };\n    fetchZonas();\n  }, []);\n\n  // Polling para eventos de la zona seleccionada\n  const fetchEventos = useCallback(async () => {\n    if (!selectedZona) return;\n    try {\n      const [carrosRes, animalesRes, alertasRes] = await Promise.all([axios.get(`${API_BASE_URL}/eventos-carros?zona_id=${selectedZona}&limit=100`), axios.get(`${API_BASE_URL}/eventos-animales?zona_id=${selectedZona}&limit=100`), axios.get(`${API_BASE_URL}/alertas?zona_id=${selectedZona}&limit=100`)]);\n\n      // Solo actualizar si hay cambios\n      const carrosHash = getHash(carrosRes.data);\n      const animalesHash = getHash(animalesRes.data);\n      const alertasHash = getHash(alertasRes.data);\n      if (carrosHash !== lastHashRef.current.carros) {\n        setEventosCarros(carrosRes.data);\n        lastHashRef.current.carros = carrosHash;\n      }\n      if (animalesHash !== lastHashRef.current.animales) {\n        setEventosAnimales(animalesRes.data);\n        lastHashRef.current.animales = animalesHash;\n      }\n      if (alertasHash !== lastHashRef.current.alertas) {\n        setAlertas(alertasRes.data);\n        lastHashRef.current.alertas = alertasHash;\n      }\n      setLoading(false);\n    } catch (error) {\n      console.error('Error cargando eventos:', error);\n      setLoading(false);\n    }\n  }, [selectedZona]);\n\n  // Setup polling\n  useEffect(() => {\n    if (!selectedZona) return;\n    setLoading(true);\n    fetchEventos();\n\n    // Polling cada 3 segundos\n    pollIntervalRef.current = setInterval(fetchEventos, 3000);\n    return () => {\n      if (pollIntervalRef.current) {\n        clearInterval(pollIntervalRef.current);\n      }\n    };\n  }, [selectedZona, fetchEventos]);\n  const handleSelectZona = useCallback(zonaId => {\n    setNotificaciones(prev => ({\n      ...prev,\n      [zonaId]: false\n    }));\n    setSelectedZona(zonaId);\n    lastHashRef.current = {}; // Resetear hash para nueva zona\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app-container\",\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {\n      zonas: zonas,\n      selectedZona: selectedZona,\n      onSelectZona: handleSelectZona,\n      notificaciones: notificaciones\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"app-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"\\uD83D\\uDE97 IoT Monitoring Dashboard\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 11\n        }, this), selectedZona && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"zona-info\",\n          children: [\"Zona Activa: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: (_zonas$find = zonas.find(z => z.id === selectedZona)) === null || _zonas$find === void 0 ? void 0 : _zonas$find.nombre\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 28\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading\",\n        children: \"Cargando...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 21\n      }, this), selectedZona && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"charts-container\",\n        children: [/*#__PURE__*/_jsxDEV(TimelineChart, {\n          eventosCarros: eventosCarros,\n          eventosAnimales: eventosAnimales,\n          alertas: alertas\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(HistoryChart, {\n          eventosCarros: eventosCarros,\n          eventosAnimales: eventosAnimales,\n          alertas: alertas\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"GOIuq/6ab2p9kDCPH86Godq5pqI=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","axios","Sidebar","TimelineChart","HistoryChart","jsxDEV","_jsxDEV","API_BASE_URL","App","_s","_zonas$find","selectedZona","setSelectedZona","zonas","setZonas","eventosCarros","setEventosCarros","eventosAnimales","setEventosAnimales","alertas","setAlertas","loading","setLoading","notificaciones","setNotificaciones","lastHashRef","pollIntervalRef","getHash","data","JSON","stringify","substring","fetchZonas","response","get","length","id","error","console","fetchEventos","carrosRes","animalesRes","alertasRes","Promise","all","carrosHash","animalesHash","alertasHash","current","carros","animales","setInterval","clearInterval","handleSelectZona","zonaId","prev","className","children","onSelectZona","fileName","_jsxFileName","lineNumber","columnNumber","find","z","nombre","_c","$RefreshReg$"],"sources":["/home/mzrojox/IOT/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport axios from 'axios';\nimport Sidebar from './components/Sidebar';\nimport TimelineChart from './components/TimelineChart';\nimport HistoryChart from './components/HistoryChart';\nimport './App.css';\n\nconst API_BASE_URL = 'http://localhost:8000/api';\n\nfunction App() {\n  const [selectedZona, setSelectedZona] = useState(null);\n  const [zonas, setZonas] = useState([]);\n  const [eventosCarros, setEventosCarros] = useState([]);\n  const [eventosAnimales, setEventosAnimales] = useState([]);\n  const [alertas, setAlertas] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [notificaciones, setNotificaciones] = useState({});\n  \n  const lastHashRef = useRef({});\n  const pollIntervalRef = useRef(null);\n\n  // Hash para detectar cambios sin recargar todo\n  const getHash = (data) => {\n    try {\n      return JSON.stringify(data).substring(0, 100);\n    } catch {\n      return '';\n    }\n  };\n\n  // Cargar zonas una sola vez\n  useEffect(() => {\n    const fetchZonas = async () => {\n      try {\n        const response = await axios.get(`${API_BASE_URL}/zonas`);\n        setZonas(response.data);\n        if (response.data.length > 0) {\n          setSelectedZona(response.data[0].id);\n        }\n      } catch (error) {\n        console.error('Error cargando zonas:', error);\n      }\n    };\n    fetchZonas();\n  }, []);\n\n  // Polling para eventos de la zona seleccionada\n  const fetchEventos = useCallback(async () => {\n    if (!selectedZona) return;\n\n    try {\n      const [carrosRes, animalesRes, alertasRes] = await Promise.all([\n        axios.get(`${API_BASE_URL}/eventos-carros?zona_id=${selectedZona}&limit=100`),\n        axios.get(`${API_BASE_URL}/eventos-animales?zona_id=${selectedZona}&limit=100`),\n        axios.get(`${API_BASE_URL}/alertas?zona_id=${selectedZona}&limit=100`),\n      ]);\n\n      // Solo actualizar si hay cambios\n      const carrosHash = getHash(carrosRes.data);\n      const animalesHash = getHash(animalesRes.data);\n      const alertasHash = getHash(alertasRes.data);\n\n      if (carrosHash !== lastHashRef.current.carros) {\n        setEventosCarros(carrosRes.data);\n        lastHashRef.current.carros = carrosHash;\n      }\n\n      if (animalesHash !== lastHashRef.current.animales) {\n        setEventosAnimales(animalesRes.data);\n        lastHashRef.current.animales = animalesHash;\n      }\n\n      if (alertasHash !== lastHashRef.current.alertas) {\n        setAlertas(alertasRes.data);\n        lastHashRef.current.alertas = alertasHash;\n      }\n\n      setLoading(false);\n    } catch (error) {\n      console.error('Error cargando eventos:', error);\n      setLoading(false);\n    }\n  }, [selectedZona]);\n\n  // Setup polling\n  useEffect(() => {\n    if (!selectedZona) return;\n\n    setLoading(true);\n    fetchEventos();\n\n    // Polling cada 3 segundos\n    pollIntervalRef.current = setInterval(fetchEventos, 3000);\n\n    return () => {\n      if (pollIntervalRef.current) {\n        clearInterval(pollIntervalRef.current);\n      }\n    };\n  }, [selectedZona, fetchEventos]);\n\n  const handleSelectZona = useCallback((zonaId) => {\n    setNotificaciones(prev => ({ ...prev, [zonaId]: false }));\n    setSelectedZona(zonaId);\n    lastHashRef.current = {}; // Resetear hash para nueva zona\n  }, []);\n\n  return (\n    <div className=\"app-container\">\n      <Sidebar\n        zonas={zonas}\n        selectedZona={selectedZona}\n        onSelectZona={handleSelectZona}\n        notificaciones={notificaciones}\n      />\n      <div className=\"main-content\">\n        <header className=\"app-header\">\n          <h1>ðŸš— IoT Monitoring Dashboard</h1>\n          {selectedZona && (\n            <p className=\"zona-info\">\n              Zona Activa: <strong>{zonas.find(z => z.id === selectedZona)?.nombre}</strong>\n            </p>\n          )}\n        </header>\n\n        {loading && <div className=\"loading\">Cargando...</div>}\n\n        {selectedZona && (\n          <div className=\"charts-container\">\n            <TimelineChart\n              eventosCarros={eventosCarros}\n              eventosAnimales={eventosAnimales}\n              alertas={alertas}\n            />\n            <HistoryChart\n              eventosCarros={eventosCarros}\n              eventosAnimales={eventosAnimales}\n              alertas={alertas}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}